<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Clinic SOAP Generator</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 20px;
      line-height: 1.5;
    }
    label { display: block; margin-top: 8px; }
    .section { margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #ccc; }
    textarea { width: 100%; height: 250px; }
    select, input { padding: 4px; margin-top: 4px; }
    button { padding: 8px 14px; margin-top: 10px; cursor: pointer; }
  </style>
</head>

<body>

<h2>Clinic SOAP Generator</h2>

<div class="section">
  <strong>Patient Info</strong><br>
  Age: <input id="age" type="number" min="0" max="120" style="width: 60px;">
  Sex:
  <select id="sex">
    <option value="">--</option>
    <option value="M">Male</option>
    <option value="F">Female</option>
  </select>
</div>

<div class="section">
  <label>Chief complaint:</label>
  <select id="ccSelect">
    <option value="">Select</option>
    <option value="sore_throat">Sore throat</option>
    <option value="fever">Fever / URI</option>
    <option value="abd_pain">Abdominal pain</option>
  </select>
</div>

<div class="section">
  <strong>History questions:</strong>
  <div id="historyArea">Select a chief complaint to begin.</div>
</div>

<button id="generateBtn">Generate SOAP</button>

<div class="section">
  <strong>Output (copy into HIS):</strong>
  <textarea id="output"></textarea>
</div>

<script>
// ========================== TEMPLATE DEFINITIONS ==========================
const templates = {
  sore_throat: {
    nameEn: "sore throat",
    history: [
      { id: "duration", labelEn: "Duration", labelZh: "症狀多久？（天）", type: "text" },
      { id: "fever", labelEn: "Fever history / maximal temperature", labelZh: "發燒？最高幾度？", type: "text" },
      { id: "cough", labelEn: "Cough", labelZh: "咳嗽？", type: "text" },
      { id: "rhinorrhea", labelEn: "Rhinorrhea / nasal congestion", labelZh: "流鼻水？鼻塞？", type: "text" },
      { id: "odynophagia", labelEn: "Odynophagia", labelZh: "吞嚥痛？", type: "text" },
      { id: "tocc", labelEn: "TOCC", labelZh: "接觸史 / 感染接觸者？", type: "text" }
    ],
    ddx: [
      "Viral pharyngitis (most likely)",
      "Streptococcal pharyngitis",
      "Peritonsillar abscess (if red flags)"
    ]
  },

  fever: {
    nameEn: "fever",
    history: [
      { id: "duration", labelEn: "Duration", labelZh: "發燒多久？", type: "text" },
      { id: "max_temp", labelEn: "Maximal temperature", labelZh: "最高體溫？", type: "text" },
      { id: "resp", labelEn: "Respiratory symptoms", labelZh: "呼吸道症狀（咳/痰/喉嚨痛）", type: "text" },
      { id: "gi", labelEn: "GI symptoms", labelZh: "腸胃症狀（噁心/腹瀉）", type: "text" },
      { id: "urinary", labelEn: "Urinary symptoms", labelZh: "泌尿症狀（頻尿/解尿痛）", type: "text" },
      { id: "travel", labelEn: "Travel / TOCC", labelZh: "旅遊史/TOCC", type: "text" }
    ],
    ddx: [
      "Viral infection",
      "Bacterial infection",
      "UTI (if urinary symptoms)",
      "Pneumonia (if cough/SOB)"
    ]
  },

  abd_pain: {
    nameEn: "abdominal pain",
    history: [
      { id: "duration", labelEn: "Duration", labelZh: "腹痛多久？", type: "text" },
      { id: "location", labelEn: "Pain location", labelZh: "部位？", type: "text" },
      { id: "character", labelEn: "Pain character", labelZh: "性質？（悶痛/絞痛/刺痛）", type: "text" },
      { id: "gi", labelEn: "GI symptoms", labelZh: "噁心/嘔吐/腹瀉？", type: "text" },
      { id: "bleed", labelEn: "GI bleeding", labelZh: "黑便/血便？", type: "text" },
      { id: "urinary", labelEn: "Urinary symptoms", labelZh: "泌尿症狀？", type: "text" },
      { id: "gyne", labelEn: "Gynecologic history", labelZh: "月經/懷孕可能？", type: "text" }
    ],
    ddx: [
      "Gastroenteritis",
      "Peptic ulcer disease",
      "Appendicitis",
      "Cholecystitis",
      "Renal colic",
      "Gynecologic causes (if female)"
    ]
  }
};

// ========================== UI UPDATE ==========================
const ccSelect = document.getElementById("ccSelect");
const historyArea = document.getElementById("historyArea");
const output = document.getElementById("output");

ccSelect.addEventListener("change", () => {
  const key = ccSelect.value;
  historyArea.innerHTML = "";

  if (!key) {
    historyArea.textContent = "Select a chief complaint.";
    return;
  }

  const tpl = templates[key];

  tpl.history.forEach(q => {
    const label = document.createElement("label");
    label.textContent = q.labelZh;
    const input = document.createElement("input");
    input.type = q.type;
    input.id = "q_" + q.id;
    input.style.width = "80%";
    historyArea.appendChild(label);
    historyArea.appendChild(input);
  });
});

// ========================== GENERATE SOAP ==========================
document.getElementById("generateBtn").addEventListener("click", () => {
  const key = ccSelect.value;
  if (!key) { alert("Select a chief complaint first"); return; }

  const tpl = templates[key];
  const age = document.getElementById("age").value;
  const sex = document.getElementById("sex").value; // M or F

  let S = "S:\n";

  // CC
  const duration = document.getElementById("q_duration")?.value || "";
  S += `CC: ${tpl.nameEn.charAt(0).toUpperCase() + tpl.nameEn.slice(1)}${duration ? " for " + duration : ""}\n`;

  // PI
  S += "PI:\n";
  if (age || sex) S += `${age}${sex}\n`;

  tpl.history.forEach(q => {
    const val = document.getElementById("q_" + q.id)?.value;
    if (val && q.id !== "duration") {
      S += `- ${q.labelEn}: ${val}.\n`;
    }
  });

  S += "PH: nil\nAllergy: NKA\nMed: nil\nFH: non-contributory\n\n";

  // O
  let O = "O:\nVS: T / BP\nHEENT:\nChest:\n\n";

  // DDx
  let D = "DDx:\n";
  tpl.ddx.forEach(item => D += "- " + item + "\n");

  output.value = S + O + D;
});
</script>

</body>
</html>
