<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Clinic SOAP Generator</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 20px;
      line-height: 1.5;
      background: #000;
      color: #f5f5f5;
    }
    label { display: block; margin-top: 8px; }
    .section {
      margin-bottom: 16px;
      padding: 12px;
      border-radius: 8px;
      background: #111;
      border: 1px solid #333;
    }
    textarea {
      width: 100%;
      height: 260px;
      background: #111;
      color: #f5f5f5;
      border: 1px solid #555;
      border-radius: 4px;
      padding: 8px;
    }
    select, input {
      padding: 4px;
      margin-top: 4px;
      background: #111;
      color: #f5f5f5;
      border: 1px solid #555;
      border-radius: 4px;
    }
    button {
      padding: 8px 14px;
      margin-top: 10px;
      cursor: pointer;
      border-radius: 4px;
      border: 1px solid #888;
      background: #222;
      color: #f5f5f5;
    }
    button:hover {
      background: #333;
    }
    h2 {
      margin-bottom: 16px;
    }
  </style>
</head>

<body>

<h2>Clinic SOAP Generator</h2>

<div class="section">
  <strong>Patient Info</strong><br>
  Age: <input id="age" type="number" min="0" max="120" style="width: 60px;">
  Sex:
  <select id="sex">
    <option value="">--</option>
    <option value="M">Male</option>
    <option value="F">Female</option>
  </select>
</div>

<div class="section">
  <strong>Past / Allergy / Med / Family history</strong>
  <label>PH (past history):</label>
  <input id="ph" type="text" placeholder="e.g. HTN, DM；留白預設 denied">
  <label>Allergy:</label>
  <input id="allergy" type="text" placeholder="留白預設 NKA">
  <label>Med (regular medication):</label>
  <input id="med" type="text" placeholder="留白預設 denied">
  <label>FH (family history):</label>
  <input id="fh" type="text" placeholder="留白預設 no contributory">
</div>

<div class="section">
  <label>Chief complaint:</label>
  <select id="ccSelect">
    <option value="">Select</option>
    <option value="sore_throat">Sore throat</option>
    <option value="fever">Fever / URI</option>
    <option value="abd_pain">Abdominal pain</option>
  </select>
</div>

<div class="section">
  <strong>History questions:</strong>
  <div id="historyArea">Select a chief complaint to begin.</div>
</div>

<button id="generateBtn">Generate SOAP</button>

<div class="section">
  <strong>Output (copy into HIS):</strong>
  <textarea id="output"></textarea>
</div>

<script>
// ========================== TEMPLATE DEFINITIONS ==========================
const templates = {
  sore_throat: {
    nameEn: "sore throat",
    history: [
      { id: "duration", labelEn: "Duration", labelZh: "症狀多久？（天）", type: "text" },
      { id: "fever", labelEn: "Fever history / maximal temperature", labelZh: "發燒？最高幾度？", type: "text" },
      { id: "cough", labelEn: "Cough", labelZh: "咳嗽？", type: "text" },
      { id: "rhinorrhea", labelEn: "Rhinorrhea / nasal congestion", labelZh: "流鼻水？鼻塞？", type: "text" },
      { id: "odynophagia", labelEn: "Odynophagia", labelZh: "吞嚥痛？", type: "text" },
      { id: "tocc", labelEn: "TOCC", labelZh: "接觸史 / 感染接觸者？", type: "text" }
    ],
    ddx: [
      "Viral pharyngitis (most likely)",
      "Streptococcal pharyngitis",
      "Peritonsillar abscess (if red flags)"
    ]
  },

  fever: {
    nameEn: "fever",
    history: [
      { id: "duration", labelEn: "Duration", labelZh: "發燒多久？", type: "text" },
      { id: "max_temp", labelEn: "Maximal temperature", labelZh: "最高體溫？", type: "text" },
      { id: "resp", labelEn: "Respiratory symptoms", labelZh: "呼吸道症狀（咳/痰/喉嚨痛）", type: "text" },
      { id: "gi", labelEn: "GI symptoms", labelZh: "腸胃症狀（噁心/腹瀉）", type: "text" },
      { id: "urinary", labelEn: "Urinary symptoms", labelZh: "泌尿症狀（頻尿/解尿痛）", type: "text" },
      { id: "travel", labelEn: "Travel / TOCC", labelZh: "旅遊史/TOCC", type: "text" }
    ],
    ddx: [
      "Viral infection",
      "Bacterial infection",
      "UTI (if urinary symptoms)",
      "Pneumonia (if cough/SOB)"
    ]
  },

  abd_pain: {
    nameEn: "abdominal pain",
    history: [
      { id: "duration", labelEn: "Duration", labelZh: "腹痛多久？", type: "text" },
      { id: "location", labelEn: "Pain location", labelZh: "部位？", type: "text" },
      { id: "character", labelEn: "Pain character", labelZh: "性質？（悶痛/絞痛/刺痛）", type: "text" },
      { id: "gi", labelEn: "GI symptoms", labelZh: "噁心/嘔吐/腹瀉？", type: "text" },
      { id: "bleed", labelEn: "GI bleeding", labelZh: "黑便/血便？", type: "text" },
      { id: "urinary", labelEn: "Urinary symptoms", labelZh: "泌尿症狀？", type: "text" },
      { id: "gyne", labelEn: "Gynecologic history", labelZh: "月經/懷孕可能？", type: "text" }
    ],
    ddx: [
      "Gastroenteritis",
      "Peptic ulcer disease",
      "Appendicitis",
      "Cholecystitis",
      "Renal colic",
      "Gynecologic causes (if female)"
    ]
  }
};

// ========================== UI UPDATE ==========================
const ccSelect = document.getElementById("ccSelect");
const historyArea = document.getElementById("historyArea");
const output = document.getElementById("output");

ccSelect.addEventListener("change", () => {
  const key = ccSelect.value;
  historyArea.innerHTML = "";

  if (!key) {
    historyArea.textContent = "Select a chief complaint.";
    return;
  }

  const tpl = templates[key];

  tpl.history.forEach(q => {
    const label = document.createElement("label");
    label.textContent = q.labelZh;
    const input = document.createElement("input");
    input.type = q.type;
    input.id = "q_" + q.id;
    input.style.width = "80%";
    historyArea.appendChild(label);
    historyArea.appendChild(input);
  });
});

// ========================== GENERATE SOAP ==========================
document.getElementById("generateBtn").addEventListener("click", () => {
  const key = ccSelect.value;
  if (!key) { alert("Select a chief complaint first"); return; }

  const tpl = templates[key];
  const age = document.getElementById("age").value;
  const sex = document.getElementById("sex").value; // M or F

  // PH / Allergy / Med / FH（有填用填的，沒填用預設）
  const ph = (document.getElementById("ph").value || "").trim();
  const allergy = (document.getElementById("allergy").value || "").trim();
  const med = (document.getElementById("med").value || "").trim();
  const fh = (document.getElementById("fh").value || "").trim();

  let S = "S:\n";

  // CC
  const duration = document.getElementById("q_duration")?.value || "";
  S += `CC: ${tpl.nameEn.charAt(0).toUpperCase() + tpl.nameEn.slice(1)}${duration ? " for " + duration : ""}\n`;

  // PI
  S += "PI:\n";
  if (age || sex) S += `${age}${sex}\n`;

  tpl.history.forEach(q => {
    const val = document.getElementById("q_" + q.id)?.value;
    if (val && q.id !== "duration") {
      S += `- ${q.labelEn}: ${val}.\n`;
    }
  });

  // PH / Allergy / Med / FH
  S += `PH: ${ph || "denied"}\n`;
  S += `Allergy: ${allergy || "NKA"}\n`;
  S += `Med: ${med || "denied"}\n`;
  S += `FH: ${fh || "no contributory"}\n\n`;

  // O
  let O = "O:\nVS: T / BP\nHEENT:\nChest:\n\n";

  // DDx
  let D = "DDx:\n";
  tpl.ddx.forEach(item => D += "- " + item + "\n");

  output.value = S + O + D;
});
</script>

</body>
</html>
